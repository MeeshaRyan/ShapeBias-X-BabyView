---
title: "BVTranscripts-Vs-CDIs"
output: html_document
date: "2025-10-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

i want to match the lemmas that appear in bv transc. to lemmas in bv cdis and then see, within age group, how many times each word appears in both datasets

so i need to:
- apply age groups to the bv cdi df
- group by age group for the graph
- within each age group i need to know how many of the SAME unique lemmas appeared in both sources


```{r}
child_spoken <- bv_clean_age_calculated %>% 
  select(-orig_token, -age_started_recording, -token_start_time, -token_end_time) %>% 
  mutate(
    age_group = case_when(
      age >= 9 & age <= 12.9999 ~ "9-12",
      age >= 13 & age <= 15.9999 ~ "13-15", 
      age >= 16 & age <= 18.9999 ~ "16-18",
      age >= 19 & age <= 21.9999 ~ "19-21",
      age >= 22 & age <= 24.9999 ~ "22-24",
      age >= 25 & age <= 27.9999 ~ "25-27",
      age >= 28 & age <= 30 ~ "28-30",
      TRUE ~  NA_character_
      ), 
  lemma = tolower(lemma),
  source = "child-spoken",
    ) %>% 
  filter(!is.na(age_group))

bv_CDI <- combined_clean_l %>% 
  select(-sex, -birth_order, -file_tag) %>%
  mutate(age = as.numeric(age),
    age_group = case_when(
      age >= 8.9 & age <= 12.9999 ~ "9-12",
      age >= 13 & age <= 15.9999 ~ "13-15", 
      age >= 16 & age <= 18.9999 ~ "16-18",
      age >= 19 & age <= 21.9999 ~ "19-21",
      age >= 22 & age <= 24.9999 ~ "22-24",
      age >= 25 & age <= 27.9999 ~ "25-27",
      age >= 28 & age <= 30 ~ "28-30",
      TRUE ~  NA_character_
      ), 
    source = "bv_CDI",
    )
# names(child_spoken)
# names(bv_CDI)



combined_spoken_heard <- full_join(
  child_spoken,
  bv_CDI,
  by = "age_group", 
  suffix = c(".sp", ".cdi")
  )

## join error - vector limit reached
# n_sp <- child_spoken %>% count(age_group, name = "n_sp")
# n_cdi <- bv_CDI %>% count(age_group, name = "n_cdi")
# 
# n_sp %>%
#   inner_join(n_cdi, by = "age_group") %>%
#   mutate(prod = n_sp * n_cdi) %>%
#   summarise(total_rows_if_joined = sum(prod, na.rm = TRUE))



```


Attempting this again: using bv cdis df, filter for NA, run hunspell to get english words only (no special characters)

```{r}
library(tidyverse)
library(stringr)
library(hunspell)

bv_cdi_combined <- read.csv("/Users/meesha/Desktop/ShapeBias-X-BabyView/BV-Eng-CDIs/bv_cdis_combined.csv")

bv_cdi_combined2 <- bv_cdi_combined %>% 
 filter(!is.na(value))

test_clean <- bv_cdi_combined2 %>% 
  mutate(variable = str_replace(bv_cdi_combined2$variable, "\\..*$", "")) %>%
  filter(str_detect(variable, "^[A-Za-z_]+$"))

test_clean2 <- test_clean$variable[hunspell_check(test_clean$variable)]

test_clean2 <- as.data.frame(test_clean2)

test_filtered <- test_clean %>% 
  filter(variable %in% test_clean2$test_clean2)
view(test_filtered)


```

POS model for nouns, re-merge for the final df
```{r}
# Load udpipe model
library(udpipe)
model <- udpipe_download_model("english")
udmodel_english <- udpipe_load_model(model$file_model)

# Annotate with POS, keeping row_id
test_bv_cdis_pos <- udpipe_annotate(
  udmodel_english,
  x = test_filtered$variable,
  doc_id = test_filtered$administration_id
)
test_bv_cdis_pos_df <- as.data.frame(test_bv_cdis_pos)

test2_bv_cdis_pos_df <- test_bv_cdis_pos_df %>% 
  filter(upos == "NOUN")

bv_cdi_nouns <- test_filtered %>% 
  filter(variable %in% test2_bv_cdis_pos_df$lemma) %>% 
  filter(value == "produces")

write.csv(bv_cdi_nouns, "bv_cdi_nouns.csv", row.names = FALSE)

```

```{r}
#make a df with the frequencies of adult utterances for each lemma by age of the child?

#early_utt_per_child <- bv_cdi_nouns %>% 
  #group_by(subject_id, age)
  

frequency_utt_heard <- bv_adult_nouns_child_age %>% 
  count(lemma, sort = TRUE)

library(ggplot2)


```

